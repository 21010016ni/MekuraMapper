まずそもそも音とは何かについてわかってない感じがする

DxLibで立体音響を扱うにあたって、必要とされる要素は左右の振れ幅（パン）と音量（ボリューム）の二つ
うち、パンの方は自分から見た角度を取って成形するだけなので簡単
問題は音量の方であり、どうしたものかと思っています
音は空気など物質に吸音されて減衰されていく
その減衰率はよくわかんないけど、たぶん重力とかと同じ感覚なのではないだろうか
たとえば100mの高さから落ちた時、重力加速度が10.0m/sなら1秒後には90m、2秒後には70mとなる
最初の高さをv、重力加速度をg、経過時間をtとおいたとき、式は

x = v - sigma(i=1:t,g * i)

となる　なる？たぶんなる

この式をそのまま音量に当てはめると、
距離をl、減衰率をdとおいて、

x = 1 - sigma(i=1:l, d * i)

となるんだけど合ってる？

減衰率を0.1、距離を2とおく　と音量は0.7となる　距離が1なら0.9　いったんこれでやってみる
距離が小数点の場合はどうなる？　考慮していなかった　漸近させる？
2.7なら、2までは普通にやって最後に2.7を代入したものを引く

かなりよさげ　あとはこれにディレイを加えるとよい
ディレイも同じく適当な定数を定義して、距離に応じた遅延をかける
しかし結局1/60秒間隔でしか設定できないしな　という話はある　音速ってどのくらいだっけ
海面上で340.29m/s　てことは1フレームディレイがかかる距離は2.83575m　音が往復するため
え？　結構強めにディレイかけてもいい感じじゃんね
面倒なので音速は300m/sとして、1フレームディレイかかる距離は2.5m
プレイヤーはグリッドの中央に立つと仮定して、1マス5m²なら自分のマスにあるとき1フレーム遅延、一つ先のマスに壁があるなら3フレーム
だから距離を一マス1x1として、中央から計上すると距離0.5につき1フレーム遅延となる
自分のマスに壁があるときちょっと処理が微妙になりそうな気配があるため、0.6n+1とかにしてもいい

実装上では、SEを遅延再生かけられるクラスを作ります

反響について、これ重なるとクソうるさくなるわけだし次の音が再生されたら前の音を止めるかな　多分それでも違和感はないはず
音量についてはどういう扱いに？　まあそのまま減らしていいか　反響音だし
と思ったんだけど、panの扱いどうしよう　いきなり変わるのは不自然では？
こう　ぐいっと動けばいいんだけど　パッと切り替わるんじゃなくて

ていうかなんか3Dサウンド用の関数あるね　これ使えばいいのでは？

いったん設計を見直す
3Dサウンドを用いる場合、設定しなきゃいけないのは音の再生位置のみ
音量については多分自動で減衰する　と思う
自分の位置は別に原点固定でいいし　いいか？　振りむきとか移動とか、自分の位置の方を動かした方が自然かもしれない　その方が楽そう

てことは、自分の座標と音の再生位置
グリッド上のタイルやオブジェクトが自発的に音を発生させるし、プレイヤーの足音に反応して反響音もある

反響についてはどのように？
音をそのまま重ねるのではだめでは？　でもどうなるのか
原理的にはむしろ重ねた方が自然か　アホうるさくなりそうで怖い

あとは方向フォーカス時の足音について
というか、プレイヤーの周辺の座標に限定して音の再生を有効化して、その有効化の範囲を絞る感じ？

どういう流れにしよう
そもそも音を受け取る距離が設定できるから、それで聞こえない音もそのまま鳴らしてもいいんだけど
それで処理負荷はどうなのか
また、その場合方向フォーカス時にはどうなるのか

方向フォーカスの要件
・音が聞こえる範囲を特定方向に絞る
　一方向のみ　放射状に広がるとかでもなく、一直線
・反響音に課されるディレイの増大
　通常の10倍くらい？

そもそも反響音をサポートするシステムがDxLibの3Dサウンド関数にないので、そこは自作する必要がある
だからそこにディレイ増大の仕組みを作るのはたぶんできる
問題はそもそも方向を絞るとはどういうことなのかって話
あ　でも反響音に関してはRayを一本だけにすればいいのか

問題は普通に聞こえる音
これは、正確には音を聞こえるようにするんじゃなくてほかの音が聞こえないようにする

一番簡単なのは、特定方向以外のすべての音の距離を引き離すとか
音情報は座標の形でどのみち管理する必要があるから、それはおそらく可能
ただあんまりスマートじゃない
結局音を再生するときに音リストをさらう必要があるわけだから、その時に制限するか
問題は水の音とかの常に再生される音
これどうしよう　ループ再生を手動にするとか　でも音量が徐々に小さくなる演出が欲しい
じゃあループ再生させておいて、更新のタイミングで方向外だったら音量を絞っていく

てことは音だけを先に作っておくのは不可能だな？　先にマップオブジェクトを作らなきゃ